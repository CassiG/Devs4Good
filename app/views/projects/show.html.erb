<h2 class="page-title"><%= @project.title %></h2>

<h2 class='interior-title'>Project Details</h2>
<div>Summary: <%= @project.summary %></div>
<div>Description: <%= raw(@project.description) %></div>

<h2 class='interior-title'>Contact Details</h2>
<div>
  Requested by: <span class='interior-links'><%= link_to(@project.organization.org_name, organization_path(@project.organization.id)) %></span><br/>
  <% if logged_in? && (current_user.user_type == 'dev' || @project.organization.id == current_user.id ) && @project.contact_email != '' %>
  Project contact e-mail: <span class='interior-links'><%= mail_to(@project.contact_email) %></span>
  <% end %>
</div>
<div>Time frame: <%= @project.time_frame %></div>

<% if logged_in? && current_user.user_type == 'org' && @project.organization.id == current_user.id %>
  <span class='link-button'><%= link_to('Edit', edit_organization_project_path(@project.organization, @project)) %></span>
  <span class='link-button'><%= link_to('Delete', organization_project_path, method: :delete, data: { confirm: 'Are you sure?' }) %></span>
<% end %>

<% if logged_in? && current_user.user_type == 'dev' %>
  <span class='link-button'><%= link_to('Add Proposal', new_project_proposal_path(@project)) %></span>
<% end %>

<% if @project.selected_proposal %>
  <div>
    <h3 class='interior-title'>Selected proposal:</h3>
    <span class='interior-links'><%= link_to(@project.selected_proposal.developer.full_name, developer_path(@project.selected_proposal.developer)) %></span>
  </div>
<% end %>

<% if logged_in? && current_user.user_type == 'org' && @project.organization.id == current_user.id %>
<h3 class='interior-title'>Proposals: </h3>
  <div class='cards'>
    <% @project.proposals.each do |proposal| %>
    <div class='card'>
        <div class='card-copy'> <%= link_to(proposal.developer.full_name, project_proposal_path(proposal.project, proposal))  %> </div>
        <% if !@project.selected_proposal %>
          <%= form_for proposal, url: project_proposal_path(@project.id, proposal.id) do |f| %>
            <%= f.hidden_field :selected, :value => 'true' %>
            <%= f.submit "Select" %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>

<% if logged_in? && current_user.user_type == 'dev' %>
<h3 class= 'interior-title'>My Proposals: </h3>
<div class='cards'>
  <ul>
      <% @project.developer_proposal(current_user).each do |proposal| %>
      <div class='card'>
        <div class='card-copy'>
          <li><%= link_to(raw(proposal.developer.full_name), project_proposal_path(@project.id, proposal.id)) %></li>
        </div>
      </div>
    <% end %>
  </ul>
</div>
<% end %>
